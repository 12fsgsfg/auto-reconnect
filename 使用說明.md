# Auto Reconnect Plugin 使用說明

## 🚀 快速開始

### 方法1：使用簡化版（推薦新手）
1. 運行 `build-simple.bat` 編譯插件
2. 運行 `test-plugin.bat` 測試插件功能
3. 查看控制台輸出，了解插件工作原理

### 方法2：使用完整版（需要Velocity環境）
1. 運行 `download-deps.bat` 下載依賴庫
2. 運行 `build.bat` 編譯完整版插件
3. 將生成的JAR文件放入Velocity的plugins目錄

## 📁 文件說明

- **`SimpleAutoReconnectPlugin.java`** - 簡化版插件，不依賴外部庫
- **`build-simple.bat`** - 編譯簡化版插件
- **`test-plugin.bat`** - 測試插件功能
- **`download-deps.bat`** - 下載完整版依賴
- **`build.bat`** - 編譯完整版插件

## 🔧 插件功能

### 核心特性
- ✅ **雙分流管理**: lobby和wait服務器
- ✅ **自動重連**: wait服務器離線時自動重連
- ✅ **智能監控**: 每10秒檢查一次服務器狀態
- ✅ **延遲重連**: 5秒延遲避免頻繁重連
- ✅ **重試機制**: 最多10次重連嘗試

### 配置參數
```java
private static final long CHECK_INTERVAL = 10;        // 檢查間隔（秒）
private static final long RECONNECT_DELAY = 5;        // 重連延遲（秒）
private static final int MAX_RECONNECT_ATTEMPTS = 10; // 最大重連次數
```

## 🧪 測試說明

### 測試流程
1. **啟動階段**: 插件啟動，服務器在線
2. **離線模擬**: 15秒後模擬服務器離線
3. **自動重連**: 觸發重連機制，每10秒檢查
4. **重連嘗試**: 5秒延遲後嘗試重連
5. **結果處理**: 成功則重置計數器，失敗則繼續嘗試

### 預期輸出
```
啟動簡化版自動重連管理器...
簡化版自動重連管理器已啟動，檢查間隔: 10 秒
模擬Wait服務器離線...
Wait服務器離線，嘗試重連... (嘗試 1/10)
正在嘗試重連Wait服務器...
模擬重連成功
Wait服務器重連成功！
```

## 🚨 常見問題

### Q: 編譯失敗怎麼辦？
A: 確保Java版本 >= 11，使用 `java -version` 檢查

### Q: 如何修改重連參數？
A: 編輯 `SimpleAutoReconnectPlugin.java` 中的常量值

### Q: 如何集成到Velocity？
A: 使用完整版插件，按照Velocity插件開發文檔操作

### Q: 插件日誌在哪裡？
A: 簡化版輸出到控制台，完整版輸出到Velocity日誌

## 📚 進階使用

### 自定義重連策略
```java
// 修改檢查間隔
private static final long CHECK_INTERVAL = 30; // 改為30秒

// 修改重連延遲
private static final long RECONNECT_DELAY = 10; // 改為10秒

// 修改最大嘗試次數
private static final int MAX_RECONNECT_ATTEMPTS = 20; // 改為20次
```

### 添加更多服務器
```java
// 在ServerManager中添加新服務器
public static final String GAME_SERVER = "game";
public static final String MINIGAME_SERVER = "minigame";
```

## 🔗 相關資源

- [Velocity官方文檔](https://docs.velocitypowered.com/)
- [Java並發編程](https://docs.oracle.com/javase/tutorial/essential/concurrency/)
- [Maven使用指南](https://maven.apache.org/guides/)

## 📞 技術支持

如果遇到問題：
1. 檢查Java版本和環境變量
2. 查看控制台錯誤信息
3. 確認文件路徑正確
4. 參考README.md和PROJECT_STRUCTURE.md

---

**注意**: 簡化版僅用於測試和學習，生產環境請使用完整版插件！
